Harika bir karar. GeÃ§miÅŸteki "savaÅŸ alanÄ±nÄ±" temizleyip, projenin **ÅŸu anki Ã§alÄ±ÅŸan, temiz ve nihai mimarisini** anlatan teknik bir manifesto hazÄ±rladÄ±m.

Bu raporu kopyalayÄ±p sakla. Yeni bir AI ile sohbete baÅŸlarken (bende veya baÅŸka bir modelde) bu metni "Context" olarak yapÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nda, proje hakimiyeti %100 olacak.

---

# ğŸ“˜ PROJE TEKNÄ°K DÃ–KÃœMANTASYONU VE MÄ°MARÄ° RAPORU
**Proje AdÄ±:** Library Management System (Backend)
**Teknoloji YÄ±ÄŸÄ±nÄ±:** Java 21, Spring Boot 3.x, Hibernate/JPA, MySQL 8.0, Lombok, Docker.
**Mimari Desen:** Controller-Service-Repository (C-S-R) + DTO Pattern.

---

## 1. Mimari Prensipler ve Kurallar

Bu projede Ã§alÄ±ÅŸan veya kod yazacak tÃ¼m AI modelleri ÅŸu kurallara uymalÄ±dÄ±r:

1.  **Strict DTO Usage:** Controller katmanÄ± asla ve asla `Entity` (VeritabanÄ± nesnesi) dÃ¶nmez. Mutlaka `RequestDTO` alÄ±r ve `ResponseDTO` dÃ¶ner.
2.  **BaseEntity Inheritance:** TÃ¼m entity'ler `BaseEntity` sÄ±nÄ±fÄ±ndan tÃ¼retilir. ID (`Long id`), OluÅŸturulma Tarihi (`created_at`) ve GÃ¼ncellenme Tarihi (`updated_at`) bu sÄ±nÄ±ftan yÃ¶netilir.
3.  **Lombok Usage:** `@Data`, `@RequiredArgsConstructor` (Constructor Injection iÃ§in), `@Builder` aktif olarak kullanÄ±lÄ±r.
4.  **Database Strategy:** Tablolar `update` modunda Ã§alÄ±ÅŸÄ±r. `BaseEntity` iÃ§inde `created_at` (updatable=false) ve `updated_at` otomatik yÃ¶netilir (`@PrePersist`, `@PreUpdate`).

---

## 2. VeritabanÄ± VarlÄ±klarÄ± (Entities) ve Ä°ÅŸlevleri

Projenin kalbi olan entity'lerin gÃ¼ncel durumu ve iliÅŸkileri aÅŸaÄŸÄ±dadÄ±r.

### ğŸ§± Temel YapÄ± TaÅŸÄ±
* **`BaseEntity`**: Soyut (Abstract) sÄ±nÄ±ftÄ±r.
    * **GÃ¶revi:** TÃ¼m tablolar iÃ§in `id` (Primary Key), `created_at` ve `updated_at` kolonlarÄ±nÄ± standartlaÅŸtÄ±rÄ±r.
    * **Kural:** DiÄŸer hiÃ§bir entity kendi iÃ§inde `private Long id` tanÄ±mlamaz, buradan miras alÄ±r.

### ğŸ“š Kitap ve Katalog YÃ¶netimi
* **`Book`**: KÃ¼tÃ¼phanedeki fiziksel veya dijital kitaplarÄ± temsil eder.
    * **Ä°liÅŸkiler:**
        * `Category` ile **Many-to-One** (Bir kitabÄ±n tek bir kategorisi olur).
        * `Tag` ile **Many-to-Many** (Bir kitabÄ±n birden fazla his/vibe etiketi olabilir - "HÃ¼zÃ¼nlÃ¼", "KÄ±sa" vb.).
    * **Ã–nemli Alanlar:** `availableStock` (kiralanabilir stok), `totalStock`, `isEditorsPick` (EditÃ¶r seÃ§imi boolean), `bookType` (Enum: PHYSICAL, DIGITAL).
* **`Category`**: KitaplarÄ±n tÃ¼rÃ¼ (Bilim Kurgu, Roman vb.).
    * **YapÄ±:** Sadece isim tutar. `Book` entity'si buraya `category_id` ile baÄŸlanÄ±r.
* **`Tag`**: "KÃ¶r Randevu" (Blind Date) Ã¶zelliÄŸi iÃ§in kullanÄ±lÄ±r.
    * **Ä°ÅŸlevi:** KitaplarÄ± tÃ¼re gÃ¶re deÄŸil, hislerine gÃ¶re (Vibe-based) filtrelemeyi saÄŸlar.

### ğŸ‘¤ KullanÄ±cÄ± ve Sosyal EtkileÅŸim
* **`User`**: Sistemi kullanan Ã¼yeler.
    * **Alanlar:** `email` (Unique), `password`, `isStudent` (indirim iÃ§in opsiyonel flag).
* **`Wallet`**: KullanÄ±cÄ±nÄ±n sanal cÃ¼zdanÄ±.
    * **Ä°ÅŸlevi:** Bakiye tutar. Kitap kiralarken veya ceza Ã¶derken bakiye buradan dÃ¼ÅŸer. `User` ile One-to-One iliÅŸkilidir.
* **`Review`** (Eski Rating): KullanÄ±cÄ±larÄ±n kitaplara yaptÄ±ÄŸÄ± yorumlar.
    * **Alanlar:** `stars` (1-5), `comment` (Text), `isSpoiler` (boolean), `helpfulCount` (int).
    * **MantÄ±k:** Bir kullanÄ±cÄ± bir kitaba sadece bir yorum yapabilir (`UniqueConstraint`).
* **`Badge` & `UserBadge`**: Gamification (OyunlaÅŸtÄ±rma) sistemi.
    * **`Badge`**: Rozet tanÄ±mÄ± (Ã–rn: "Kitap Kurdu", Ä°kon Yolu).
    * **`UserBadge`**: Hangi kullanÄ±cÄ±nÄ±n hangi rozeti ne zaman kazandÄ±ÄŸÄ±nÄ± tutan iliÅŸki tablosu.

### ğŸ”„ Ä°ÅŸlem ve Hareketler
* **`Rental`**: Kiralama iÅŸlemi.
    * **Ä°ÅŸlevi:** Kim (`User`), Hangi KitabÄ± (`Book`), Ne Zaman (`rentDate`) aldÄ± ve Son Teslim Tarihi (`dueDate`) ne zaman?
    * **Durum:** Ä°ade edildiÄŸinde `returnDate` doldurulur ve stok artÄ±rÄ±lÄ±r.

---

## 3. Kritik Ä°ÅŸ MantÄ±klarÄ± (Business Logic)

Sistemdeki karmaÅŸÄ±k Ã¶zelliklerin Ã§alÄ±ÅŸma mantÄ±ÄŸÄ± ÅŸÃ¶yledir:

### A. KÃ¶r Randevu (Blind Date with a Book) ğŸ
* **AmaÃ§:** KullanÄ±cÄ±ya kitabÄ±n ismini, yazarÄ±nÄ± ve kapaÄŸÄ±nÄ± gizleyerek sadece tÃ¼rÃ¼ ve "Vibe" etiketleri (Tag) Ã¼zerinden kitap kiralamak.
* **Teknik AkÄ±ÅŸ:**
    1.  Frontend `/api/books/blind-date` endpoint'ine istek atar.
    2.  Backend, `Book` tablosundan rastgele veya tag bazlÄ± bir kitap seÃ§er.
    3.  **DTO Masking:** `BookResponseDTO` yerine `BlindBookDTO` dÃ¶ner. Bu DTO'da `title`, `author`, `image` alanlarÄ± **NULL** veya gizli metindir. Sadece `description_summary` ve `tags` gÃ¶rÃ¼nÃ¼r.
    4.  KullanÄ±cÄ± "Kirala" dediÄŸinde `Rental` kaydÄ± oluÅŸur ve kitap o zaman "Reveal" (ifÅŸa) edilir.

### B. Dashboard & Anasayfa AkÄ±ÅŸÄ± ğŸ 
* Performans iÃ§in anasayfa verileri tek tek Ã§ekilmez.
* **`HomeDashboardDTO`**: Tek bir endpoint ile "EditÃ¶rÃ¼n SeÃ§tikleri", "En Ã‡ok Kiralananlar (PopÃ¼ler)" ve "Yeni Gelenler" listeleri bir paket halinde Frontend'e gÃ¶nderilir.

### C. Yorum Sistemi ve Performans ğŸš€
* **N+1 Problemi Ã‡Ã¶zÃ¼mÃ¼:** Yorumlar listelenirken `ReviewRepository` iÃ§inde **`JOIN FETCH`** kullanÄ±lÄ±r.
    * *Sorgu:* "Yorumu getirirken, yorumu yapan `User` bilgisini ve kullanÄ±cÄ±nÄ±n `Badge`'lerini de tek seferde getir."
* **Spoiler KontrolÃ¼:** `isSpoiler = true` olan yorumlar Frontend'e "blur" efekti uygulanacak ÅŸekilde flag'li gÃ¶nderilir.

---

## 4. API Endpoint Stratejisi (Postman Kontrol Listesi)

Backend geliÅŸtirilirken aÅŸaÄŸÄ±daki Controller yapÄ±sÄ± baz alÄ±nacaktÄ±r:

| Controller | Method | Endpoint | AÃ§Ä±klama |
| :--- | :--- | :--- | :--- |
| **AuthController** | POST | `/api/auth/register` | Yeni kullanÄ±cÄ± kaydÄ±. |
| **AuthController** | POST | `/api/auth/login` | GiriÅŸ ve Token (JWT opsiyonel) Ã¼retimi. |
| **BookController** | GET | `/api/books` | TÃ¼m kitaplarÄ± listele (Pagination). |
| **BookController** | GET | `/api/books/dashboard` | Anasayfa verilerini (PopÃ¼ler, Yeni, EditÃ¶r) dÃ¶ner. |
| **BookController** | GET | `/api/books/blind-date` | MaskelenmiÅŸ (Gizli) kitap Ã¶nerisi dÃ¶ner. |
| **ReviewController** | POST | `/api/reviews` | Yorum ekle (Body: bookId, rating, comment). |
| **ReviewController** | GET | `/api/reviews/book/{bookId}` | Bir kitaba ait yorumlarÄ± getir. |
| **WalletController** | POST | `/api/wallet/add-funds` | CÃ¼zdana bakiye yÃ¼kle. |
| **RentalController** | POST | `/api/rentals` | Kitap kirala (Stok dÃ¼ÅŸ, bakiye dÃ¼ÅŸ). |

---

## 5. Docker KonfigÃ¼rasyonu (DevOps)

Proje, `docker-compose up` komutuyla herkesin bilgisayarÄ±nda sorunsuz Ã§alÄ±ÅŸacak ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r.
* **Database:** MySQL 8.0 imajÄ± kullanÄ±lÄ±r.
* **Environment:** VeritabanÄ± ismi `library_db` olarak sabitlenmiÅŸtir. Åifreler `docker-compose.yml` iÃ§inde environment variable olarak tanÄ±mlÄ±dÄ±r, manuel kuruluma gerek yoktur.

---

**AI TalimatÄ±:** Bu rapor, projenin "Single Source of Truth" (Tek DoÄŸruluk KaynaÄŸÄ±) belgesidir. Kod Ã¼retirken veya hata ayÄ±klarken buradaki entity iliÅŸkilerini ve iÅŸ kurallarÄ±nÄ± esas al. GeÃ§miÅŸteki veritabanÄ± kilitlenme sorunlarÄ±nÄ± gÃ¶z ardÄ± et, sistem ÅŸu an stabil.